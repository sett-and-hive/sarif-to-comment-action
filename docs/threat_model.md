# Threat Model: SARIF to Comment Action

**Target:** [sett-and-hive/sarif-to-comment-action](https://github.com/sett-and-hive/sarif-to-comment-action)
**Date:** November 27, 2025
**Methodology:** STRIDE (Spoofing, Tampering, Repudiation, Information Disclosure, Denial of Service, Elevation of Privilege)

## System Overview

**Description:** This GitHub Action parses a SARIF (Static Analysis Results Interchange Format) file, typically generated
by security scanners like CodeQL, Bandit, or ESLint, and posts a summary of the findings as a comment on a GitHub
Pull Request.

**Key Components:**

1. **GitHub Action Runner:** The ephemeral environment where the code executes.
2. **Input SARIF File:** A JSON file provided by the user (or a previous workflow step).
3. **Node.js Runtime:** The execution environment for the action.
4. **Dependencies:** Specifically the `@security-alert/sarif-to-comment` NPM package.
5. **GitHub API:** The destination where comments are posted.

### Data Flow Diagram (DFD)

```mermaid
graph LR
    User[User / CI Process] -->|Generates| SARIF[SARIF File (Untrusted Input)]
    SARIF -->|Read by| Action[SARIF to Comment Action]
    Config[Action Inputs (Token, Repo, Branch)] --> Action
    Action -->|Parses via| Dep[NPM: @security-alert/sarif-to-comment]
    Dep -->|Formats| Comment[Markdown Comment]
    Action -->|POST| API[GitHub API]
```

## Sequence Diagram (SD)

```mermaid
sequenceDiagram
    actor Developer
    participant CI as CI_System
    participant Runner as GitHub_Action_Runner
    participant Action as SARIF_to_Comment_Action
    participant Dep as sarif_to_comment_dependency
    participant API as GitHub_API

    Developer->>CI: Push code or open PR
    CI->>Runner: Start workflow job
    Runner->>Action: Execute with inputs (token, repo, branch, sarif_path)
    Action->>Runner: Read SARIF file from workspace
    Action->>Dep: Parse SARIF JSON
    Dep-->>Action: Formatted findings
    Action->>API: POST PR summary comment
    API-->>Action: Response (success or error)
    Action-->>Runner: Exit status
    Runner-->>CI: Report job result
```

## Trust Boundaries

### Boundary 1 (Input)

The interface between the SARIF file and the Action logic. The SARIF file is effectively user-controlled input and must
be treated as untrusted.

### Boundary 2 (External)

The interface between the Action and the GitHub API. The Action operates with the privileges of the provided
`GITHUB_TOKEN`.

### Boundary 3 (Supply Chain)

The interface between the Action code and its NPM Dependencies.

## Threat Analysis (STRIDE)

### S - Spoofing

#### Threat

Falsified Security Reports

##### Description

A malicious actor (e.g., a contributor submitting a PR) could manually craft or modify a SARIF file to show
"0 vulnerabilities" even if the code is insecure, or fabricate false positives to confuse reviewers.

##### Impact

Security team relies on false data, merging vulnerable code.

##### Likelihood

Medium

Requires the attacker to understand the CI pipeline structure.

##### Mitigation

Ensure the SARIF file is generated by a trusted tool in a previous trusted step, rather than checking in the
SARIF file to the repository.

### T - Tampering

#### Threat

Dependency Poisoning (`@security-alert/sarif-to-comment`)

##### Description

The action relies on a third-party NPM package. If that package is compromised (supply chain attack),
the action code could be altered to execute malicious logic.

##### Impact

Critical. Could lead to token exfiltration or malicious code execution in the runner.

##### Likelihood

Low/Medium (common vector in Node.js ecosystem).

##### Mitigation

Pin dependencies to specific SHA hashes or lockfiles (package-lock.json) rather than version ranges.

Use Renovate or Dependabot to monitor for upstream vulnerabilities.

#### Threat

content Injection in PR Comments

##### Description

If the SARIF parser does not sanitize rule descriptions or messages, an attacker could embed malicious
Markdown (e.g., misleading links, phishing text, or images that track IP addresses) into the SARIF file.

##### Impact

Low. GitHub sanitizes HTML/JS in comments, but "Phishing via Markdown" is still possible.

##### Mitigation

Ensure the underlying parser escapes special characters before rendering the Markdown table.

### R - Repudiation

#### Threat

Lack of Execution Logs

##### Description

If the action fails to post a comment or posts an incorrect one,
there may be insufficient logging to determine if it was a file parsing error or an API failure.

##### Impact

Low (Operational).

##### Mitigation

Implement verbose logging (visible only when ACTIONS_STEP_DEBUG is true) to trace the parsed JSON structure.

### I - Information Disclosure

#### Threat

Token Exfiltration

##### Description

The action requires inputs.token (usually `secrets.GITHUB_TOKEN`). If the action dumps the environment
variables to the log for debugging, or if a compromised dependency sends environment vars to a remote server,
the token is leaked.

##### Impact

High. The token typically has write access to the repo.

##### Likelihood

Low (standard GitHub Action risk).

##### Mitigation

Ensure `GITHUB_TOKEN` is never printed to console logs. Use the Principle of Least Privilege (grant only
`issues: write` or `pull-requests: write`, not repo scope).

#### Threat

Leaking Private Code Details in Public Comments

##### Description

If the SARIF file contains snippets of code (common in SAST tools) and the repo is private, posting these
snippets into a GitHub Comment might accidentally expose them to users who have access to the Issue but not the
Code (e.g., external collaborators).

##### Impact

Medium.

##### Mitigation

Verify if the SARIF includes source snippets and
provide an option to redact them (show-snippets: false).

### D - Denial of Service

#### Threat

SARIF Bomb (Large File Processing)

##### Description

An attacker submits a PR with a massive (e.g., 500MB) SARIF file.

##### Impact

The Node.js process runs out of memory (OOM), crashing the GitHub Action runner and stalling the CI pipeline.

##### Likelihood

Medium.

##### Mitigation

Implement file size limits or strict timeout/memory constraints on the parsing logic.

#### Threat

API Rate Limiting

##### Description

If the SARIF file contains thousands of findings and the action attempts to post
individual comments for each (or updates the same comment too frequently), it may hit GitHub API rate limits.

##### Impact

CI fails for all developers.

##### Mitigation

The action should aggregate findings into a single summary comment.

### E - Elevation of Privilege

#### Threat

Command Injection via Inputs

##### Description

The action takes inputs like title or branch. If these are passed directly to a shell command (e.g.,
`exec("git checkout " + branch)`), an attacker could name a branch `main; rm -rf /`.

##### Impact

High. Code execution on the runner.

##### Likelihood

Medium. Depends on implementation (using exec vs spawn or API calls).

##### Mitigation

Avoid shell execution. Use the GitHub REST API libraries (@actions/github, octokit) directly. Specific
inputs should be validated against an allowlist (alphanumeric only).

## Summary of Critical Findings

| Severity  | Threat                  | Category  | Remediation                                                                      |
| --------- | ----------------------  |-----------|----------------------------------------------------------------------------------|
| High      | Supply Chain Compromise | Tampering | Pin dependencies and review `@security-alert/sarif-to-comment` security posture. |
| High      | Command Injection       | EoP       | Audit code to ensure inputs (branch, title) are not passed to `exec()`.          |
| Medium    | SARIF "Bomb" / OOM      | DoS       | Add file size checks before parsing JSON.                                        |
| Medium    | Phishing via Markdown   | Tampering | Sanitize text from SARIF before rendering Markdown.                              |

## Next Steps for Engineers

### Code Audit

Search the codebase for `exec`, `spawn`, or `eval` to rule out injection risks. There is the code of the action itself,
but also the code of `@security-alert/sarif-to-comment`.

### Dependency Check

Run npm audit and verify the maintenance status of `@security-alert/sarif-to-comment`.

### Permission Review

Update documentation to recommend minimal permissions (`permissions: pull-requests: write`) in the workflow YAML.
